<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title></title>
		<script type="text/javascript">
			(function(w, d) {
				function setREM() {
					var __h = d.documentElement,
						__b = d.body;
					__w = __h.clientWidth || __b.clientWidth;
					var __f = __w / 18.75;
					__h.style.fontSize = __f + 'px';
				}
				setREM()
				w.onresize = function() {
					setTimeout(function() {
						setREM()
					}, 100)
				}
			})(window, window.document)
		</script>
		<style type="text/css">
			@-ms-viewport {
				width: device-width;
			}
			
			@-o-viewport {
				width: device-width;
			}
			
			@viewport {
				width: device-width;
			}
		</style>
		<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<link rel="stylesheet" href="../css/personal.css" />
		<link rel="stylesheet" href="../css/swiper-3.4.2.min.css" />
		<script>
			// Copyright 2014-2015 Twitter, Inc.
			// Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
			if(navigator.userAgent.match(/IEMobile\/10\.0/)) {
				var msViewportStyle = document.createElement('style')
				msViewportStyle.appendChild(
					document.createTextNode(
						'@-ms-viewport{width:auto!important}'
					)
				)
				document.querySelector('head').appendChild(msViewportStyle)
			}
		</script>
		<link rel="stylesheet" href="../css/boot.css" />
		<link rel="stylesheet" href="../css/theme.css" />
		<link rel="stylesheet" href="../css/newtheme.css" />
	</head>

	<body class="hasNav fullscreen">

		<div role="navigation" class="navbar-fixed-top">
			<div class="container-fluid">
				<div class="pull-left">
					<a role="backlink" class="glyphicon glyphicon-menu-left" href="javascript:history.go(-1);"></a>
				</div>
				<div class="pull-right">
				</div>
				<div role="navtitle" class="navtitle">
					商品详情
				</div>
			</div>
		</div>

		
				<div class="integrationbox">
							<div class="integration"><span>剩余</span><span class="integralnum"></span><span>积分</span></div>
						</div>
		
		<div class="bodyMax">
			<div class="bodyOne">
				<div class="swiper-wrapper">

				</div>
			</div>
		</div>

		<div class="bodyTwo">
			<ul>
				<li>
					<p><span>编</span><span>号:</span></p>
					<p class="shopnum"></p>
				</li>
				<li>
					<p><span>价</span><span>格:</span></p>
					<p class=""><span class="orange shopmoney"></span>积分</p>
				</li>
				<li>
					<p><span>名</span><span>称:</span></p>
					<p class="shopname"></p>
				</li>
				<li>
					<p> <span>详</span>
					<span>细</span>
					<span>介</span>
					<span>绍:</span></p>
					<p class="shoptitile"></p>
				</li>
			</ul>
		</div>
		<div class="btnNext">
			<button>兑换</button>
		</div>
		<div id="reminder">
		    <div class="reminderBody">
		        <div class="reminderContext">
		            <div><span id="msg"></span></div>
		        </div>
		    </div>
		</div>
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
		<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
		<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
		<script src="../js/swiper-3.4.2.min.js"></script>
		<script src="../js/fx.js"></script>
		<script type="text/javascript" src="../js/sm.js" charset="utf-8"></script>
		<script src="../js/zepto.scroll.js"></script>
		<script src="../js/touch.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/underscore.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/cookie.js"></script>
		<script src="../js/gjk.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			(function($) {
				var userIntegrate,productIntegratePrice;
				function GetRequest() {

					var url = location.search; //获取url中"?"符后的字串
					var theRequest = new Object();
					if(url.indexOf("?") != -1) {
						var str = url.substr(1);
						strs = str.split("&");
						for(var i = 0; i < strs.length; i++) {
							theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
						}
					}
					return theRequest;
				}
				var str = GetRequest();
				var idNum = "";
				$.each(str, function(key, val) {
					idNum = key
				})

				function getData() {
					var _url = "account";
					var _data = {};
					var _success = function(obj) {
						userIntegrate = obj.data.userIntegrate;
						console.log(obj);
						if(obj.success == true) {
							$(".integralnum").html(userIntegrate);
						}
					};
					var _error = function(obj) {
						console.log(obj.message);
					};
					$.gjk.ajax.postAjax(_url, _data, _success, _error, function() {}, "POST", "integral_details");
					var __url = "product/list";
					var _success = function(obj) {
						console.log(obj);
						console.log(obj.data);
						if(obj.success == true) {
							$.each(obj.data, function(key, val) {
								if(val.productId == idNum) {
									productIntegratePrice = val.productIntegratePrice;
									$(".shopnum").text(val.productNo);
									$(".shopmoney").text(productIntegratePrice);
									$(".shopname").text(val.productName);
									$(".shoptitile").text(val.productDetail);
									$.each(val.productImgs, function(key, val) {
										appendImg(val.productImgUrl)
									})
								}
							})
						}
					};
					var _error = function(obj) {
						console.log(obj.message);
					};
					$.gjk.ajax.postAjax(__url, _data, _success, _error, function() {}, "POST", "integral_details");
				}
				
				function appendImg(url) {
					var swiper = new Swiper('.bodyOne', {});
					swiper.appendSlide('<div class="swiper-slide">	<img src="' + url + '" alt="" /></div>')
					//$(".swiper-wrapper").append('<div class="swiper-slide">	<img src="' + url + '" alt="" /></div>')
				}
				getData();
				
				$(".btnNext").on("click", function() {
					if(userIntegrate < productIntegratePrice){
						 var $msg = $('#msg');
				         var $reminder = $('#reminder');
				         $reminder.show();
				         $msg.text("您的积分不足，无法兑换商品！");
				
				         setTimeout(function () {
				             $reminder.hide();
				         }, 2000);
						return;
					}else{
						window.location.href = $.gjk.path_url +  "self/pointdetail.html?" + idNum;
					}
					
				})
			})(Zepto)
		</script>
	</body>

</html>