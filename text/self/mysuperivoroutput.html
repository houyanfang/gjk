<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <script type="text/javascript">
        (function (w, d) {
            function setREM() {
                var __h = d.documentElement,
                    __b = d.body;
                __w = __h.clientWidth || __b.clientWidth;
                var __f = __w / 18.75;
                __h.style.fontSize = __f + 'px';
            }

            setREM()
            w.onresize = function () {
                setTimeout(function () {
                    setREM()
                }, 100)
            }
        })(window, window.document)
    </script>
    <style type="text/css">
        @-ms-viewport {
            width: device-width;
        }

        @-o-viewport {
            width: device-width;
        }

        @viewport {
            width: device-width;
        }
    </style>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/personal.css"/>
    <script>
        // Copyright 2014-2015 Twitter, Inc.
        // Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
        if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
            var msViewportStyle = document.createElement('style')
            msViewportStyle.appendChild(
                document.createTextNode(
                    '@-ms-viewport{width:auto!important}'
                )
            )
            document.querySelector('head').appendChild(msViewportStyle)
        }
    </script>
    <link rel="stylesheet" href="../css/boot.css"/>
    <link rel="stylesheet" href="../css/theme.css"/>
    <link rel="stylesheet" href="../css/newtheme.css"/>
</head>

<body class="hasNav hasFoot fullscreen">

<div role="navigation" class="navbar-fixed-top">
    <div class="container-fluid">
        <div class="pull-left">
            <a role="backlink" class="glyphicon glyphicon-menu-left" href="javascript:history.go(-1);"></a>
        </div>
        <div class="pull-right">
            <a href="javascript:void();"></a>
        </div>
        <div role="navtitle">
            我的监督人
        </div>
    </div>
</div>

<div role="identification" class="identification">
    <div class="upload-box paddingbot paddingtop">
        <div class="row hide noDate">
            <div class="col-xs-8">
                <p class="padding10 margin5 text-gray">生成监督人唯一码</p>
            </div>
            <div class="col-xs-4 text-right">
                <button class="circular btn btn-yellow text-white marginr10 addCode" style="color: #FFFFFF;">生成</button>
            </div>
        </div>
        <div class="row hide hasDate">
            <div class="col-xs-3 paddingl5">
                <img src="" alt="" class="headImg" style="width: 100%;border-radius:12.5%"/>
            </div>
            <div class="col-xs-5" style="padding-left: 0;">
                <p class="margin5 text-gray headName"></p>
            </div>
            <div class="col-xs-4 text-right">
                <a href="" class="circular btn btn-yellow text-white marginr10 removeCode"
                   style="margin-top: 13%;">解绑</a>
            </div>
        </div>

    </div>
    <div class="upload-box paddingbot paddingtop">

        <div class="row">
            <div class="col-xs-8">
                <p class="padding10 margin5">唯一码：<span class="code"></span></p>
            </div>
            <div class="col-xs-4 text-right copy">
                <a href="" class="circular btn btn-gray text-white marginr10 hide oranges" data-clipboard-action="copy"
                   data-clipboard-target="span" style="color: #FFFFFF;">复制</a>
            </div>
        </div>
    </div>
    <!--model层-->
    <div id="reminder">
        <div class="reminderBody">
            <div class="reminderContext">
                <div><span id="msg"></span><!--<span id="num">2s</span>--></div>
            </div>
        </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->
    <script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->

    <script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
    <!--<script src="../js/fx.js"></script>
<script src="../js/zepto.scroll.js"></script>-->
    <script src="../js/touch.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/underscore.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/cookie.js"></script>
    <script src="../js/gjk.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/clipboard.min.js"></script>
    <script src="../js/base.js"></script>
    <script type="text/javascript">
        (function ($, $1) {
            $(".btn-gray").on("click", function () {
                copyUrl2()
            })
            function alertMmodel(obj) {
                var $msg = $('#msg');
                var $reminder = $('#reminder');
                $reminder.show();
                $msg.html(obj);
                setTimeout(function () {
                    $reminder.hide();
                }, 2000)
            }
            function copyUrl2() {
                var clipboard = new Clipboard('.btn');
                clipboard.on('success', function (e) {
                    e.clearSelection();
                    // TODO 复制成功后弹出层
                    alertMmodel("复制成功")
                });
                clipboard.on('error', function (e) {
                    console.error('Action:', e.action);
                    console.error('Trigger:', e.trigger);
                });
            }

            function getData() {
                var _url = "mskluser/findGuardian";
                var _data = {};
                var _success = function (obj) {
                    //console.log(data.data.nickName);
                    console.log(obj);
                    if (obj.success == true) {
                        if (obj.data.guardian_type != 1) {
                            $(".noDate").removeClass("hide");
                            if (obj.data.code) {
                                $(".btn-gray").removeClass("hide")
                                $(".code").html(obj.data.code);
                                $(".oranges").removeClass("btn-gray")
                                $(".addCode").removeClass("btn-yellow").addClass("btn-gray")
                                $(".addCode").disabled = true;

                            }
                            else {
                                $1(".addCode").on("click", addCode)
                            }

                        }
                        else {
                            $(".hasDate").removeClass("hide");
                            $(".headImg").attr("src", obj.data.guardian_photo);
                            $(".headName").html(obj.data.guardian_name);
                            $(".code").html(obj.data.code);
                            $1(".removeCode").on("click", function () {
                                removeCode(obj.data.code)
                                $(".hasDate").addClass("hide");
                                $(".noDate").removeClass("hide");
                            })
                        }
                    }
                };
                var _error = function (obj) {
                    console.log(obj.message);
                };

                $.gjk.ajax.postAjax(_url, _data, _success, _error, function () {
                }, "POST", "mysuperivoroutput");

                function addCode() {
                    var _url = "mskluser/makeOnlyCode";
                    var _data = {};
                    var _success = function (obj) {
                        if (obj.success == true) {
//									alert("绑定成功")
                            alertMmodel("绑定成功");

                            $(".btn-gray").removeClass("hide")
                            if (obj.data != undefined) {
                                $(".code").html(obj.data)
                                $(".code").disabled = true;
                            }

                        }
                    };
                    var _error = function (obj) {
//                        alert(obj.message);
                    };
                    $.gjk.ajax.postAjax(_url, _data, _success, _error, function () {
                    }, "POST", "mysuperivoroutput");
                }


                //解绑
                function removeCode(codenum) {
                    var _url = "mskluser/unboundGuardian";
                    var _data = {"data": codenum};
                    var _success = function (obj) {
                        if (obj.success == true) {
                            alertMmodel("解绑成功");
                        }
                    };
                    var _error = function (obj) {
                        alert(obj.message);
                    };
                    $.gjk.ajax.postAjax(_url, _data, _success, _error, function () {
                    }, "POST", "mysuperivoroutput");
                };
            }

            getData()
        })(Zepto, jQuery)
    </script>
</body>

</html>