<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <script type="text/javascript">
        (function (w, d) {
            function setREM() {
                var __h = d.documentElement, __b = d.body;
                __w = __h.clientWidth || __b.clientWidth;
                var __f = __w / 18.75;
                __h.style.fontSize = __f + 'px';
            }

            setREM()
            w.onresize = function () {
                setTimeout(function () {
                    setREM()
                }, 100)
            }
        })(window, window.document)
    </script>
    <style type="text/css">
        @-ms-viewport {
            width: device-width;
        }

        @-o-viewport {
            width: device-width;
        }

        @viewport {
            width: device-width;
        }
    </style>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script>
        // Copyright 2014-2015 Twitter, Inc.
        // Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
        if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
            var msViewportStyle = document.createElement('style')
            msViewportStyle.appendChild(
                document.createTextNode(
                    '@-ms-viewport{width:auto!important}'
                )
            )
            document.querySelector('head').appendChild(msViewportStyle)
        }
    </script>
    <link rel="stylesheet" href="../css/boot.css"/>
    <link rel="stylesheet" href="../css/theme.css"/>
    <link rel="stylesheet" href="../css/newtheme.css"/>
    <link rel="stylesheet" href="../css/personal.css"/>
</head>

<body class="hasNav">

<div role="navigation" class="navbar-fixed-top">
    <div class="container-fluid">
        <div class="pull-left">
            <a role="backlink" class="glyphicon glyphicon-menu-left" href="javascript:history.go(-1);"></a>
        </div>
        <div role="navtitle">
           	 积分商城
        </div>
    </div>
</div>

<div class="upload-box">
    <div class="point-row row clearfix">
        <div class="col-xs-3 paddinglf0">
            <div class="product-img">
            	<img src="" />
            </div>
        </div>
        <div class="col-xs-9">
            <div class="row">
                <div class="col-xs-9 margin10">
                    <div class="row">
                        <span class="text-gray">产品编号：</span>
                        <span class="shopnum"></span>
                    </div>
                    <div class="row">
                        <span class="text-gray">产品详情：</span>
                        <span class="shopname"></span>
                    </div>
                    <div class="row">
                        <span class="text-gray">产品价格：</span>
                        <span><b class="text-yellow shopmoney"></b></span>
                    </div>
                </div>
                <div class="col-xs-3 margin5">

                </div>
            </div>
        </div>

    </div>
</div>

<div class="upload-box paddingbot">
    <div class="container-fluid margin5">
        <div class="row margin10">
            <div class="pull-left paddinglf">
                <span class="font14">订单编号：</span>
            </div>
            <div class="pull-left">
                <span class="addressnumber"></span>
            </div>
        </div>
        <div class="row margin10">
            <div class="pull-left paddinglf">
                <span>订单时间：</span>
            </div>
            <div class="pull-left">
                <span class="addresstime"></span>
            </div>
        </div>
    </div>
</div>

<div class="upload-box addsite hide">
    <div class="point-form">
        <div class="address-icon"></div>
        <span class="addAddress" style="font-size: 16px;padding-left:5px ;">新增地址</span>
    </div>
</div>
<div role="identification" class="site upload-box clearfix">
    <!--<div class="sitemin">
        <div class="address-icon"></div>
    </div>-->
    <i class="pull-right inlinks glyphicon glyphicon-menu-right"></i>
    <div class="center">
        <div class="address">
        	<div class="address-icon" style="opacity: 0;"></div>
        	<span class="addressName"></span>
        	<span class="addressphone"></span>
        </div>
        <div class="address">
        	<div class="address-icon"></div>
        	<span class="address-site"></span>
        </div>
    </div>
</div>
<div role="identification" class="identification">
    <div class="identification-form-view">
        <div class="identification-form-submit">
            <a class="circular  fishBtn" href="javascript:;" >完成</a>
        </div>
    </div>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<script src="../js/swiper-3.4.2.min.js"></script>
<script src="../js/fx.js"></script>
<script type="text/javascript" src="../js/sm.js" charset="utf-8"></script>
<script src="../js/zepto.scroll.js"></script>
<script src="../js/touch.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/underscore.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/cookie.js"></script>
<script src="../js/gjk.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/base.js"></script>
<script type="text/javascript">
    (function ($) {
    	var _productId,_linkName,_orderNo,_linkMobile,_userAddressConntent;
        getData();
        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        var str = GetRequest();
        var idNum = "";
        $.each(str, function (key, val) {
        	console.log(key);
            idNum = key;
        })

        function getData() {
            var __url = "product/list";
            var _data = {};
            var _success = function (obj) {
                console.log(obj);
                if (obj.success == true) {
                    $.each(obj.data, function (key, val) {
                        if (val.productId == idNum) {
                        	_productId = val.productId;
                            $(".shopnum").text(val.productNo);
                            $(".shopmoney").text(val.productIntegratePrice);
                            $(".shopname").text(val.productName);
                            //$(".product-img").css({ "background": "url(" + val.productImgs[1].productImgUrl + ")" });
                            $(".product-img img").attr("src","http://122.194.216.11:8080/img"+val.productImgs[0].productImgUrl.split(",")[0])
                            getName(idNum);
                        }
                    })
                }
            };
            var _error = function (obj) {
                console.log(obj.message);
            };
            $.gjk.ajax.postAjax(__url, _data, _success, _error, function () {
            }, "POST", "pointdetail");
        }

        function appendImg(url) {
            $(".swiper-wrapper").append('<div class="swiper-slide">	<img src="' + url + '" alt="" /></div>')
        }
        getAddress();
        //收获地址详情
        var addr = [];
        function getAddress(){
			var _url = "address/list";
			var _data = {};
			var _success = function(obj){
				console.log(obj);
				if(obj.success == true && obj.data.length>0){
					addr = obj.data.filter(function(item){
						if(item.isDefault == 1){
							return item;
						}
					});
					_userAddressConntent = addr[0].province + addr[0].city +addr[0].area + addr[0].userAddressConntent;
					$('.address-site').text(_userAddressConntent);
				}else{
					$('.address-site').text("");
				}
			}
			var _error = function(){}
			var _complete = function(){}
			$.gjk.ajax.postAjax(_url,_data,_success,_error,_complete,"POST","pointdetail");
			
		}
        
        function getName(num) {
            var __url = "order/convert/" + num;
            var _data = {};
            var _success = function (obj) {
            	console.log(obj);
            	console.log(obj.data);
                if (obj.success == true && obj.data.linkMobile != null && obj.data.linkName != null && obj.data.userAddressConntent != null) {
                    var arr = obj.data.userAddressConntent.split(";");
                    var str = arr[0].split(",").join("") + arr[1];
                    _linkName = obj.data.linkName;
                    _linkMobile = obj.data.linkMobile;
                    _orderNo = obj.data.orderNo;
                    console.log(_orderNo);
                    $(".addressName").text(_linkName);
                    $(".addressphone").text(_linkMobile);
                    $(".address-site").text(str);
                    $(".addressnumber").text(_orderNo);
                    
                    $(".addresstime").text(format(obj.data.orderDatetime, 'yyyy-MM-dd'))
                    $(".site").on("click", function () {
                        window.location.href = $.gjk.path_url + "self/addsite.html?"  + num;
                    })
                } if(obj.success == true && obj.data.linkMobile == null && obj.data.linkName == null &&  obj.data.userAddressConntent == null) {
//                 
 					$(".addressName").text("");
                    $(".addressphone").text("");
                    
                    $(".address-site").text("");
                    $(".addressnumber").text(obj.data.orderNo);
                    
                    $(".addresstime").text(format(obj.data.orderDatetime, 'yyyy-MM-dd'))
                    $(".site").on("click", function () {
                        window.location.href = $.gjk.path_url + "self/addsite.html?"  + num;
//                      
                    })
                }

            };
            var _error = function (obj) {
                console.log(obj.message);
            };
            $.gjk.ajax.postAjax(__url, _data, _success, _error, function () {
            }, "POST", "pointdetail");
        }

        function format(time, format) {
            var t = new Date(time);
            var tf = function (i) {
                return (i < 10 ? '0' : '') + i
            };
            return format.replace(/yyyy|MM|dd/g, function (a) {
                switch (a) {
                    case 'yyyy':
                        return tf(t.getFullYear());
                        break;
                    case 'MM':
                        return tf(t.getMonth() + 1);
                        break;
                    case 'dd':
                        return tf(t.getDate());
                        break;
                }
            })
        }

        $(".fishBtn").on("click", function () {
        	
            var _url = "order/add";
            var _data = {
                "productId": _productId,
                "orderNo": _orderNo,
                "linkName": _linkName,
                "linkMobile": _linkMobile,
                "userAddressConntent": _userAddressConntent
            };
            var _success = function (obj) {
                console.log(obj);
                if (obj.success == true) {
//              	console.log("123455678");
                	window.location.href = $.gjk.path_url + "self/mypoint.html";
//					$('.circular').attr('href',goUrl);
//                  console.log(goUrl);
                }else{
                	console.log(obj.message);
                }
            }
            var _error = function (res) {
                console.log("出错啦！！");
            }
            $.gjk.ajax.postAjax(_url, _data, _success, _error, function () {
            }, "POST", "pointdetail");
        })
    })(Zepto)
</script>
</body>

</html>